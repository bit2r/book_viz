<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2 . 행복한 시각화 | 데이터 시각화</title>
<meta name="author" content="한국 R 사용자회">
<meta name="description" content="캐나다 브리티쉬 콜럼비아 대학 STAT545 교육과정이 공개되어 초창기 데이터 과학이 정립될 때 큰 역할을 하였다. “행복한 시각화 생활을 위한 비밀” 장에 성공적인 시각화를 핵심적인 내용이 담겨있다. 시각화 그래프를 제작하는데 어려움이 있다면, ggplot2 코드에 문제가 있다고 시각화 관련 부분에 집중적인 시간을 투여할 것이다. 하지만 다음...">
<meta name="generator" content="bookdown 0.26 with bs4_book()">
<meta property="og:title" content="2 . 행복한 시각화 | 데이터 시각화">
<meta property="og:type" content="book">
<meta property="og:description" content="캐나다 브리티쉬 콜럼비아 대학 STAT545 교육과정이 공개되어 초창기 데이터 과학이 정립될 때 큰 역할을 하였다. “행복한 시각화 생활을 위한 비밀” 장에 성공적인 시각화를 핵심적인 내용이 담겨있다. 시각화 그래프를 제작하는데 어려움이 있다면, ggplot2 코드에 문제가 있다고 시각화 관련 부분에 집중적인 시간을 투여할 것이다. 하지만 다음...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="2 . 행복한 시각화 | 데이터 시각화">
<meta name="twitter:description" content="캐나다 브리티쉬 콜럼비아 대학 STAT545 교육과정이 공개되어 초창기 데이터 과학이 정립될 때 큰 역할을 하였다. “행복한 시각화 생활을 위한 비밀” 장에 성공적인 시각화를 핵심적인 내용이 담겨있다. 시각화 그래프를 제작하는데 어려움이 있다면, ggplot2 코드에 문제가 있다고 시각화 관련 부분에 집중적인 시간을 투여할 것이다. 하지만 다음...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.1/transition.js"></script><script src="libs/bs3compat-0.3.1/tabs.js"></script><script src="libs/bs3compat-0.3.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<style type="text/css">
    /* Used with Pandoc 2.11+ new --citeproc when CSL is used */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
        }
    .hanging div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">데이터 시각화</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">데이터 시각화</a></li>
<li><a class="" href="hello-world.html"><span class="header-section-number">1</span> 헬로우 월드</a></li>
<li><a class="active" href="happy-viz.html"><span class="header-section-number">2</span> 행복한 시각화</a></li>
<li><a class="" href="%EC%8B%9C%EA%B0%81%ED%99%94-%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C.html">시각화 구성요소</a></li>
<li><a class="" href="viz-font.html"><span class="header-section-number">3</span> 글꼴</a></li>
<li><a class="" href="viz-color.html"><span class="header-section-number">4</span> 색상</a></li>
<li><a class="" href="ggplot-component.html"><span class="header-section-number">5</span> 구성요소</a></li>
<li><a class="" href="%EC%8B%9C%EA%B0%81%ED%99%94-%EC%A0%84%EC%9A%A9-%EB%8D%B0%EC%9D%B4%ED%84%B0.html">시각화 전용 데이터</a></li>
<li><a class="" href="tidy-data.html"><span class="header-section-number">6</span> 깔끔한 데이터 개념</a></li>
<li><a class="" href="ggplot-datasets.html"><span class="header-section-number">7</span> 준비된 데이터</a></li>
<li><a class="" href="tidy-data-how.html"><span class="header-section-number">8</span> 깔끔화 방법</a></li>
<li><a class="" href="%EC%8B%9C%EA%B0%81%ED%99%94.html">시각화</a></li>
<li><a class="" href="ggplot.html"><span class="header-section-number">9</span> 그래프 문법</a></li>
<li><a class="" href="ggplot-visualization.html"><span class="header-section-number">10</span> ggplot 시각화</a></li>
<li><a class="" href="ggplot-pattern.html"><span class="header-section-number">11</span> 시각화 패턴</a></li>
<li><a class="" href="%EC%82%AC%EB%A1%80.html">사례</a></li>
<li><a class="" href="case-journalism.html"><span class="header-section-number">12</span> 데이터 저널리즘</a></li>
<li><a class="" href="case-corona.html"><span class="header-section-number">13</span> 코로나19</a></li>
<li><a class="" href="case-worldcup.html"><span class="header-section-number">14</span> 러시아 월드컵</a></li>
<li><a class="" href="references-1.html">References</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="happy-viz" class="section level1" number="2">
<h1>
<span class="header-section-number">2 . </span> 행복한 시각화<a class="anchor" aria-label="anchor" href="#happy-viz"><i class="fas fa-link"></i></a>
</h1>
<p>캐나다 브리티쉬 콜럼비아 대학 <a href="https://stat545.com/">STAT545</a> 교육과정이 공개되어
초창기 데이터 과학이 정립될 때 큰 역할을 하였다.
“행복한 시각화 생활을 위한 비밀” 장에 성공적인 시각화를 핵심적인 내용이 담겨있다.</p>
<p>시각화 그래프를 제작하는데 어려움이 있다면,
<code>ggplot2</code> 코드에 문제가 있다고 시각화 관련 부분에 집중적인 시간을 투여할 것이다.
하지만 다음 세가지 지점을 먼저 살펴봐라.</p>
<ul>
<li>데이터프레임에 시각화 관련 작업을 담아둔다.</li>
<li>데이터프레임을 <em>깔끔하게(tidy)</em> 제작한다; 시각화에 적절한 자료형으로 변환</li>
<li>범주형(factor) 변수를 적절히 활용함은 물론 범주형 자료 장인이 된다.</li>
</ul>
<p>나중에 심도있게 다룰 시각화 자료구조인 깔끔한 <strong>데이터(Tidy Data)</strong>를 제작하게 되면
그동안 자신을 괴롭혔던 시각화 관련 문제는 자연히 사라져 버린다.
이를 위해서 <code>dplyr</code> 패키지의 데이터 다루는 여러 동사를 <code>tidyr</code> 패키지
깔끔한 데이터 제작 동사와 결합하여 사용하게 되면 생산성을 크게 높일 수 있다.</p>
<div id="viz-secret-dataframe" class="section level2" number="2.1">
<h2>
<span class="header-section-number">2.1</span> 시각화 입력 자료구조: 데이터프레임<a class="anchor" aria-label="anchor" href="#viz-secret-dataframe"><i class="fas fa-link"></i></a>
</h2>
<p>기억해야 할 단 한가지 사항은 시각화 자료구조는 데이터프레임이다.
좀더 구체적으로 <strong>깔끔한 데이터</strong>다.
시각화 산출물을이 동일하다고 하더라도 작성한 코드를 면밀히 살펴보면
가독성이 떨어짐은 물론 <code>tidyverse</code> 관습과 동떨어진 경우를 종종 보게 된다.</p>
<p>예를 들어, 많은 경우 변수가 데이터프레임 밖에 복사되어
작업공간에 독립된 객체로 존재시켜 이를 시각화하는 것이다.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jennybc/gapminder">gapminder</a></span><span class="op">)</span>
<span class="va">life_exp</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span>
<span class="va">year</span> <span class="op">&lt;-</span> <span class="va">gapminder</span><span class="op">$</span><span class="va">year</span></code></pre></div>
<p>앞선 방식의 문제는 <code>ggplot2</code> 패키지로 시각화가 되지 않고 오류가 발생된다.
근본 원인은 <code>ggplot2</code> 패키지 <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> 함수가 입력값이 데이터프레임이라는데 있다.
즉, 데이터프레임을 입력받아 시각화 그래프를 출력으로 뱉어내는데 이를 충족시키지 못할 경우
의도한 바가 컴퓨터에 전달되지 않아 오류가 나와 더이상 진전을 이룰 수가 없다.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">life_exp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>즉, 변수를 데이터프레임에 담아 보관하고 <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> 함수에 시각화 대상 데이터프레임에 전달하면 된다.
이런 전략은 R에 존재하는 다른 시각화 플랫폼에도 동일하게 적용된다.
R에는 <code>ggplot</code>을 비롯하여 Base 그래픽, <code>lattice</code> 그래픽 등 크게 3가지가 존재한다.
모두 방식에는 다소 차이가 있지만 근본적으로 데이터프레임을 입력받아 시각화 그래프를 출력으로 내보낸다.</p>
<p>파이프 연산자를 사용해서 좀더 직관적으로 코드를 다음과 같이 제작하게 되면
의미가 명확해질 것이다.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">life_exp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">geom_jitter</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="happy-visualization_files/figure-html/data-in-situ-1.png" width="576" style="display: block; margin: auto;"></div>
<p>예를 들어 시각화 대상이 국가별, 대륙별, 년도별 데이터를 필터링하는 경우도 있다.
관련 모든 변수가 데이터프레임에 있게되면 훨씬 더 쉽고 안전하게 작업을 수행할 수 있다.
앞서 시각화 변수를 별도 작업공간(메모리)에 별도 저장하여 관리할 경우 대비하여
생각하게 되면 데이터프레임에 시각화 모든 정보를 담아두는 전략의 명확한 우위가 드러난다.</p>
<p><code>ggplot2</code> 시각화 시스템만 데이터프레임을 받아 시각화하는 유일한 특이한 사례는 아니다.
데이터프레임에 모든 정보를 담아두고 필요한 경우 <code>dplyr</code> 동사로 변수생성, 필터링,
그룹별 요약, 정렬 등 데이터 조작 작업을 통해 시각화 대상 데이터프레임을 만들고
이를 시각화하는 전략은 널리 인정되는 모범사례다.</p>
<p>데이터프레임을 <code>data=</code> 선택옵션으로 전달하는 것이 많이 사용되는 R 함수에 일반적인 기능이다.
예를 들어, <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, <code><a href="https://rdrr.io/r/stats/aggregate.html">aggregate()</a></code>, <code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code>, <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code>.
따라서, 이런 방식이 기본디폴트 작업방식이 된다.</p>
</div>
<div id="viz-secret-explicit-dataframe" class="section level2" number="2.2">
<h2>
<span class="header-section-number">2.2</span> <code>dplyr::data_frame()</code> 자료구조<a class="anchor" aria-label="anchor" href="#viz-secret-explicit-dataframe"><i class="fas fa-link"></i></a>
</h2>
<p>데이터는 이미 있는데 데이터프레임이 아니라면,
“왜 데이터프레임이 아닌가?” 라고 본인에게 질문을 던진다.
시각화 대상 변수는 생성했는가?
필요한 변수를 먼저 데이터프레임에 반영해 둬야 할 것이다.
<code>dplyr</code> 팩키지에 <code><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame()</a></code> 신규 함수는 내장된 <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code> 함수에 대한 개선된 버젼이다.
데이터프레임을 시각화 자료구조로 채택하게 되면
다른 변수를 정의할 수 있고, 강제변환으로 인한 데이터 훼손도 방지할 수 있다.
구체적으로 말하면, 문자열은 명시적으로 지정하지 않게 되면 요인으로 변환되지 않는다.
이것만으로도 데이터프레임과 연관된 문제를 회피할 수 있다.</p>
<p>데이터프레임에 변수를 새로 추가하는 <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code> 함수를 통해, 동일한 길이를 갖는
연관된 변수를 처리할 자동으로 데이터프레임 내부에서 처리하여 반영한다.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="va">my_dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/deprecated.html">data_frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,
             y <span class="op">=</span> <span class="va">x</span> <span class="op">^</span> <span class="fl">2</span>,
             text <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"alpha"</span>, <span class="st">"beta"</span>, <span class="st">"gamma"</span>, <span class="st">"delta"</span>, <span class="st">"epsilon"</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">my_dat</span><span class="op">)</span></code></pre></div>
<pre><code>## Rows: 5
## Columns: 3
## $ x    &lt;int&gt; 1, 2, 3, 4, 5
## $ y    &lt;dbl&gt; 1, 4, 9, 16, 25
## $ text &lt;chr&gt; "alpha", "beta", "gamma", "delta", "epsilon"</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">my_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">text</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="happy-visualization_files/figure-html/data_frame-love-1.png" width="576" style="display: block; margin: auto;"></div>
</div>
<div id="viz-secret-with" class="section level2" number="2.3">
<h2>
<span class="header-section-number">2.3</span> 다른 접근방식 <code>with()</code><a class="anchor" aria-label="anchor" href="#viz-secret-with"><i class="fas fa-link"></i></a>
</h2>
<p>데이터프레임을 시각화 입력으로 삼는 전략의 우수성을 기존 다른 접근법과 비교해보자.
슬프게도 모든 함수가 <code>data=</code> 인자를 제공하지는 않는다.
상관계수를 계산하는 <code><a href="https://rdrr.io/r/stats/cor.html">cor()</a></code> 함수를 예로 들어보자. 다음 코드는 동작하지 않는다:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span>, data <span class="op">=</span> <span class="va">gapminder</span><span class="op">)</span>
<span class="co"># Error in cor(year, lifeExp, data = gapminder) : </span>
<span class="co">#  unused argument (data = gapminder)</span></code></pre></div>
<p>물론 다음과 같이 데이터프레임 명칭을 항상 반복하면 원하는 결과를 얻을 수 있다.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">gapminder</span><span class="op">$</span><span class="va">year</span>, <span class="va">gapminder</span><span class="op">$</span><span class="va">lifeExp</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.436</code></pre>
<p>하지만, <code>gapminder</code>를 두번 타이핑하게 되어 중복 반복 작업이 있어
사람들이 싫어한다. 아마도 이렇게 <code>gapminder</code>를 반복적으로 타이핑한다는 의식속에 숨겨진 공포가
작업공간에 독립된 객체에 변수를 복사하게 만든 동기가 되지 않았나 싶다.</p>
<p><code><a href="https://rdrr.io/r/base/with.html">with()</a></code> 함수가 이런 문제를 피해나가는 해결책이 된다.
데이터프레임을 첫번째 인자로 넣는다.
두번째 인자는 특별히 격리된 환경에서 평가되는 표현식이 된다.
명령어 한줄 혹은 여러줄로 된 토막 코드가 될 수도 있다.
특별한 점은 데이터프레임에 변수를 이름으로 참조할 수 있다는 것이다.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="va">gapminder</span>,
     <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.436</code></pre>
<p><code>magrittr</code> 팩키지를 사용하게 되면, 또다른 선택욥션이 <code>%$%</code> 연산자를 사용해서 데이터프레임 내부 변수를 노출시켜 향후 연산작업을 진행해 나가는 방식도 있다. 참고로 <code>magrittr</code> 패키지의 영감을 얻어
<code>tiydverse</code> 생태계를 연결하는 <code>%&gt;%</code> 이 생겨났다.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span>
<span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/exposition.html">%$%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">lifeExp</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 0.436</code></pre>
</div>
<div id="viz-secret-case-study" class="section level2" number="2.4">
<h2>
<span class="header-section-number">2.4</span> 사례<a class="anchor" aria-label="anchor" href="#viz-secret-case-study"><i class="fas fa-link"></i></a>
</h2>
<p>특정한 국가 예를 들어 한국을 뽑아 연도별로 모든 정량적 변수를 도식화한다.</p>
<p>본능적으로 먼저 <code>gapminder</code> 데이터에서 한국을 뽑아 변수별로 루프를 돌려서
개별적으로 그림을 그리고 이를 한데 묶는다.
사실 이러한 방식으로도 작업을 수행할 수 있다.
하지만, 데이터 형태를 바꾸는 방식이 루프를 돌리는 것보다 현재 R 생태계를 고려하면 좀더 “R스럽다”.</p>
<div id="viz-secret-case-study-data" class="section level3" number="2.4.1">
<h3>
<span class="header-section-number">2.4.1</span> 데이터 형태 바꾸기<a class="anchor" aria-label="anchor" href="#viz-secret-case-study-data"><i class="fas fa-link"></i></a>
</h3>
<p>먼저 <code>gapminder</code> 데이터에서 한국만 뽑아낸다.
그리고 나서 <code>pop</code>, <code>lifeExp</code>, <code>gdpPercap</code> 변수를 <code>var</code> 동반변수를 키로
<code>value</code> 변수를 값으로 하여 변수하나로 <code><a href="https://tidyr.tidyverse.org/reference/gather.html">gather()</a></code>함수를 통해 모은다.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">korea_dat</span> <span class="op">&lt;-</span> <span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Korea, Rep."</span><span class="op">)</span>

<span class="va">korea_tidy</span> <span class="op">&lt;-</span> <span class="va">korea_dat</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">lifeExp</span>, <span class="va">gdpPercap</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"변수"</span>, values_to <span class="op">=</span> <span class="st">"값"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">korea_dat</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 12  6</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">korea_tidy</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 36  5</code></pre>
<p>필터링된 <code>korea_dat</code>는 12 행을 갖는다.
<code>korea_tidy</code> 데이터프레임에 변수를 세개 모아 쌓아서, 행의 갯수가 3 배 되는 것이 이해된다.
즉, 폭이 넓은 데이터를 길이가 긴 데이터로 바꿔서 36 행을 갖는다.</p>
</div>
<div id="viz-secret-case-study-facet" class="section level3" number="2.4.2">
<h3>
<span class="header-section-number">2.4.2</span> <code>facet</code> 기능으로 변수를 반복<a class="anchor" aria-label="anchor" href="#viz-secret-case-study-facet"><i class="fas fa-link"></i></a>
</h3>
<p>데이터가 깔끔한 데이터프레임에 반복을 돌릴 수 있는 변수를 나타내는 적절한 요인으로 구성되어서,
<code>facet</code> 기능을 구현하기만 하면 된다.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">korea_tidy</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">값</span><span class="op">)</span> <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">변수</span>, scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> 

<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1950</span>, <span class="fl">2011</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="happy-visualization_files/figure-html/korea-facet-1.png" width="576" style="display: block; margin: auto;"></div>
</div>
<div id="viz-secret-summary" class="section level3" number="2.4.3">
<h3>
<span class="header-section-number">2.4.3</span> 요약<a class="anchor" aria-label="anchor" href="#viz-secret-summary"><i class="fas fa-link"></i></a>
</h3>
<p>한국을 뽑아 시각화한 코드가 다음에 요약되어 있다.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">gapminder</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co">## 데이터프레임 데이터 조작: `dplyr`</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">country</span> <span class="op">==</span> <span class="st">"Korea, Rep."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>
  <span class="co">## 시각화를 위한 깔끔한 데이터: `tidyr`</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">pop</span>, <span class="va">lifeExp</span>, <span class="va">gdpPercap</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"변수"</span>, values_to <span class="op">=</span> <span class="st">"값"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="co">## 그래프 문법에 따른 시각화: `ggplot`</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">값</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span> <span class="va">변수</span>, scales<span class="op">=</span><span class="st">"free_y"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1950</span>, <span class="fl">2011</span>, <span class="fl">15</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>앞에서 언급한 규칙에서 나온 이득을 상기 토막 코드가 보여주고 있다.</p>
<ul>
<li>한국만 <code>dplyr</code> 패키지 <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> 함수 데이터 조작을 통해 시각화 <strong>데이터프레임</strong>으로 독립.</li>
<li>데이터를 <strong>폭넓은(wide) → 긴(long)</strong> 형태로 바꾼 전형적인 <strong>깔끔화</strong> 사례.
<ul>
<li>칼럼 세개를 칼럼 한개로 모으는데 이유는 그림에 <code>y</code>-축에 각 변수를 도식화에 용이.</li>
</ul>
</li>
<li>각 작은 그림(facet)에 속한 관측점을 구별하는데 <strong>범주</strong>(<code>변수</code>)을 사용하고 나서, 패싯 기능 적용.</li>
</ul>
</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="hello-world.html"><span class="header-section-number">1</span> 헬로우 월드</a></div>
<div class="next"><a href="%EC%8B%9C%EA%B0%81%ED%99%94-%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C.html">시각화 구성요소</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#happy-viz"><span class="header-section-number">2</span> 행복한 시각화</a></li>
<li><a class="nav-link" href="#viz-secret-dataframe"><span class="header-section-number">2.1</span> 시각화 입력 자료구조: 데이터프레임</a></li>
<li><a class="nav-link" href="#viz-secret-explicit-dataframe"><span class="header-section-number">2.2</span> dplyr::data_frame() 자료구조</a></li>
<li><a class="nav-link" href="#viz-secret-with"><span class="header-section-number">2.3</span> 다른 접근방식 with()</a></li>
<li>
<a class="nav-link" href="#viz-secret-case-study"><span class="header-section-number">2.4</span> 사례</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#viz-secret-case-study-data"><span class="header-section-number">2.4.1</span> 데이터 형태 바꾸기</a></li>
<li><a class="nav-link" href="#viz-secret-case-study-facet"><span class="header-section-number">2.4.2</span> facet 기능으로 변수를 반복</a></li>
<li><a class="nav-link" href="#viz-secret-summary"><span class="header-section-number">2.4.3</span> 요약</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>데이터 시각화</strong>" was written by 한국 R 사용자회. It was last built on 2022-05-04.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
